FROM php:8.1-cli

WORKDIR /app

RUN apt-get update && apt-get install -y unzip

# ğŸ”¹ `composer.json` ã‚’å…ˆã«ã‚³ãƒ”ãƒ¼ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨
COPY composer.json /app/
COPY composer.lock /app/

# ğŸ”¹ Composer ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" && \
    php composer-setup.php --install-dir=/usr/local/bin --filename=composer && \
    rm composer-setup.php

# ğŸ”¹ `composer install` ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
RUN composer install --no-dev --prefer-dist --no-interaction || exit 1

# ğŸ”¹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
COPY server.php /app/
COPY router.php /app/

CMD ["php", "-S", "0.0.0.0:8083", "-t", "/app", "router.php"]

